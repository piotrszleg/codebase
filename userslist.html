<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Users List</title>
</head>

<body>

<a href="\">back</a>

<script type="text/javascript">

var entityMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;',
  '/': '&#x2F;',
  '`': '&#x60;',
  '=': '&#x3D;'
};
function escapeHtml (string) {
  return String(string).replace(/[&<>"'`=\/]/g, function (s) {
    return entityMap[s];
 });
}

var getUserData=function(callback){// fetches user data from server and calls callback function with it
	var request = new XMLHttpRequest();
	request.onreadystatechange = function(e){
		if (this.readyState == 4 && this.status == 200) {
			if(e.target.responseText!==""){
			   callback(JSON.parse(e.target.responseText));
			} else{
				callback(undefined);
			}
		}
	}
	request.open('GET', '/userdata.json', true);
	request.send();
}

var levels=["user", "moderator", "admin", "owner"];

var request = new XMLHttpRequest();
request.onreadystatechange = function(e){
	if (this.readyState == 4 && this.status == 200) {
		if(e.target.responseText!==""){
		   var data=JSON.parse(e.target.responseText);
		   var table = document.createElement('table');
		   table.style.width="50%";
		   var row=table.insertRow(0);
		   row.insertCell(0).innerHTML="<b>Name</b>";
		   row.insertCell(1).innerHTML="<b>Level</b>";
		   row.insertCell(2).innerHTML="<b>Actions</b>";
		   getUserData(function(response){
			   for(var i=0; i<data.length; i++){
			   		var name=escapeHtml(data[i].name);
					var level=levels[data[i].level];
			   		var row=table.insertRow(i+1);
			   		row.insertCell(0).innerText=name;
			   		row.insertCell(1).innerText=level;
			   		var actionsCell=row.insertCell(2);
			   		
			   		if(response!==undefined){
						actionsCell.innerHTML+="<button>send message</button>";
						if(response.level>=1){
							actionsCell.innerHTML+="<button>ban</button>";
							if(response.level>=2){
								actionsCell.innerHTML+="<button>set level</button>";
							}
						}
			   		}
			   }
			});
		   document.body.appendChild(table);
		}
	}
}
request.open('GET', '/userslist.json', true);
request.send();
</script>

</body>